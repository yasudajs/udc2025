# 要件定義（UDC2025）

最終更新日: 2025-10-18

## 1. 背景・目的
- 本プロジェクトは、BODIK APIを用いて公開されている防災関連オープンデータ（例：AED、避難所、公衆トイレ等）を取得し、地図上に分かりやすく可視化するWebアプリを構築する。
- 使用技術はFlask（Python 3.7系）で、ロリポップ（Nginx + LiteSpeed）環境で運用する。
- ビジネス/利用目的: オープンデータ活用のテストケース作成と公開。
- 成功指標: KPIは設定しない。アプリが正しく動作し、Webで一般公開できれば成功とする。

## 2. スコープ
- 対象：Webアプリ本体、地図表示、BODIK APIからのデータ取得、（必要に応じて）簡易キャッシュ/保存、静的コンテンツ、サーバー側設定。
- 非対象：ネイティブモバイル/デスクトップアプリ、認証や高度な管理機能（当面）

## 3. ターゲットユーザー/ペルソナ
- 一般市民（ITに詳しくない人でも使えるUI）
- スマホ/PC両対応（モバイルファースト）
- ペルソナ例：
	- 高齢者や保護者が、近くのAEDや避難所をすぐに探したい。
	- 外出先で最寄りの公衆トイレを地図で確認したい。

## 4. 想定ユースケース
- UC-01（周辺検索）：現在地付近のAED/避難所/公衆トイレを地図で一覧表示する。
- UC-02（カテゴリ絞り込み）：カテゴリ（AED/避難所/公衆トイレ等）で表示を切り替える/複数選択する。
- UC-03（詳細確認）：ピンをタップして詳細（名称、住所、営業時間、備考など）を表示する。
- UC-04（経路案内）：外部地図アプリ（Googleマップ等）に遷移して経路を表示するリンクを提供する。
- UC-05（データ更新）：最新データをBODIK APIから取得して地図を更新する（自動/手動の方針は後述）。

補足（初期設定）
- 地図ライブラリはLeafletを採用。
- デフォルト中心はブラウザのGeolocation APIによる現在地。位置情報が拒否/失敗した場合は「カテゴリー選択のみ先に可能」とし、地図は全国俯瞰（日本全体のバウンディング）で表示する暫定案。

## 5. 主要機能（候補）
- F-01：地図表示とマーカー描画（AED/避難所/公衆トイレ）
- F-02：カテゴリフィルタ/検索（名称・住所）
- F-03：地点詳細のポップアップ/モーダル表示
- F-04：外部経路案内リンク（Googleマップ等）
- F-05：BODIK API連携（取得・整形・キャッシュ方針）
	- 初期カテゴリ優先度: 公衆トイレ > 避難所 > AED。将来的にユーザーがメニュー順を入れ替え可能にする。

## 6. 非機能要件
- パフォーマンス: 一般的なスマホ回線でも初回表示3〜5秒程度を目安（データ量に依存）。
- 可用性: 公開中は基本的に24/7稼働（メンテ時除く）。
- セキュリティ: HTTPS必須、外部APIキーが必要な場合は環境変数管理（現状BODIKは公開想定）。
- 運用: ログ取得（アクセス/エラー）、障害時の簡易復旧手順を整備。
- レスポンシブ: モバイルファースト設計、主要ブラウザでの動作。
- スケーラビリティ: 将来のPython/Flaskアップグレード方針（3.x系への移行計画）。

## 7. 制約・前提
- サーバー: ロリポップ（Nginx + LiteSpeed）
- Python: 3.7.17（EOL）
- 利用可能ライブラリ: `requirements_server.txt` 参照（Flask 2.2.5 など）
- BODIK APIの提供仕様/スループット/レート制限に従う。
- データ永続化は必須ではない。必要に応じて選択：MySQL 8.0 / SQLite / JSONファイルキャッシュ。
	- 初期はJSONファイルキャッシュ（24h）を前提とし、規模/要件に応じてSQLite/MySQLへ移行可能とする。

## 8. 想定画面（概要）
- トップ/マップ画面（初期表示）：地図＋カテゴリフィルタ＋現在地ボタン
- 詳細表示（モーダル/ポップアップ）
- 使い方/ヘルプ（簡易）

## 9. 成果物
- 仕様書一式（本ドキュメント、機能仕様、画面設計、DB設計、デプロイ手順、環境情報）
- ソースコード（後続）

## 10. リスクと対策
- R-01: Python 3.7のEOL → 既存サーバーに合わせてパッケージ固定、将来的な3.10+移行計画を策定。
- R-02: レンタルサーバーの制約 → 提供される実行形態（WSGI/FCGI等）を確認し手順に反映。
- R-03: 外部API依存 → BODIK APIの仕様変更/停止に備え、キャッシュ/フェイルセーフを検討。

## 11. 承認
- オーナー: [記入]
- ステークホルダー: [記入]
- 承認日: [記入]

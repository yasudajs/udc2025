# 機能仕様（UDC2025）

最終更新日: 2025-10-18

## 1. 概要
本ドキュメントはUDC2025の機能仕様を定義する。BODIK APIから取得した防災系オープンデータ（AED/避難所/公衆トイレ等）を地図上に表示し、カテゴリ切替・詳細確認・外部経路案内を提供する。

対応カテゴリ: 「AED（aed）」「医療機関（hospital）」「公衆無線LAN（public_wireless_lan）」「指定緊急避難場所（evacuation_space）」「公衆トイレ（public_toilet）」
初期表示カテゴリ: AED（aed）。ユーザーは任意にカテゴリを切り替え可能。

## 2. 用語
- ユーザー（一般/管理）: [定義]
- セッション: [定義]

## 3. 機能一覧（ドラフト）
| ID | 機能名 | 概要 | 重要度 | 備考 |
|----|--------|------|--------|------|
| F-01 | 地図表示/現在地 | 地図描画・現在地取得・ズーム/パン | 高 | Leaflet採用 |
| F-02 | データ取得 | BODIK APIからカテゴリデータ取得 | 高 | レート/失敗時の扱い定義 |
| F-03 | マーカー描画/詳細 | マーカー表示とポップアップ/モーダル | 高 | フィールドマッピング |
| F-04 | フィルタ/検索 | カテゴリ切替・検索 | 中 | 
| F-05 | 経路案内リンク | 外部地図アプリへ遷移 | 中 | Google/Apple/OSMのURLスキーム

（後で確定）

## 4. 画面-機能マッピング
| 画面ID | 画面名 | 関連機能 |
|--------|--------|----------|
| P-01 | マップ | F-01, F-02, F-03, F-04, F-05 |

## 5. 各機能詳細テンプレート
以下テンプレを各機能で複製して詳細化する。

### F-01: 地図表示/現在地
- 目的: 地図を描画し、ユーザーの現在地を表示できるようにする。
- 入力: ブラウザのGeolocation API（任意）
- 出力: 地図タイル、現在地マーカー
- 前提/制約: HTTPS必須（位置情報取得のため）。
- 例外/エラー: 位置情報拒否/失敗時は、日本全体俯瞰で表示し、カテゴリ選択は可能とする（中心点は未固定）。
- 受け入れ条件: 主要ブラウザ（PC/スマホ）で地図が操作可能。

### F-02: データ取得（BODIK API）
- 目的: カテゴリ（AED/避難所/公衆トイレ等）別にBODIK APIからデータを取得する。
- 入力: カテゴリ、範囲/クエリ（未定）
- 出力: 標準化した地点データ配列（lat, lng, name, address, attrs...）
- 前提/制約: APIレート/スキーマ変更に留意。CORS/サーバー経由プロキシの検討あり。
- 例外/エラー: タイムアウト/失敗時はキャッシュ/リトライ/エラーメッセージ表示。
- 受け入れ条件: 代表カテゴリでデータを取得し、マーカー描画に連携可能。

### F-03: マーカー描画/詳細
- 目的: 地点をマーカーで描画し、タップ/クリックで詳細表示。
- 入力: 標準化地点データ
- 出力: 地図上のマーカー、ポップアップ
- 表示情報: 名称、住所、電話番号、営業時間、備考（remarks）
- 前提/制約: データが未登録の項目は「データ未登録」と表示。
- 例外/エラー: 無効座標はスキップしログ。
- 受け入れ条件: 主要カテゴリで正しい位置・名称が表示される。

### F-04: フィルタ/検索
- 目的: カテゴリ切替・名称/住所での検索。
- 入力: 選択カテゴリ、検索文字列
- 出力: 絞り込まれたマーカー
- 前提/制約: クライアント側/サーバー側どちらで行うかはデータ量に依存。
- 受け入れ条件: 目視確認できる範囲で正しく絞り込める。

### F-05: 経路案内リンク
- 目的: 外部地図アプリへの経路リンク提供。
- 入力: 緯度経度
- 出力: 外部リンクURL
- 前提/制約: 端末/OSによりURLスキーム差分あり。
- 受け入れ条件: PC/スマホで適切なアプリ/サイトが開く。

## 6. 権限/ロール
- 一般ユーザー: [権限]
- 管理者: [権限]

## 7. バリデーション方針
- 共通入力チェック、エラーメッセージのガイドライン

## 8. 国際化/日本語対応
- 文字コードUTF-8、タイムゾーンJST、曜日/日付表記

## 9. 非機能影響
- レスポンス、スループット、セキュリティ（CSRF/XSS/SQLi）

## 10. 依存関係
- Flask 2.2.5 / Python 3.7.17
- 地図ライブラリ（Leaflet想定）
- データ保存は任意（MySQL/SQLite/JSONファイルのいずれか）
